
clear;
close all;

percent=5;

data=load('/Users/ytun/Google Drive/IMPORTANT_VISION/MobiSys2015_labeling/labelPupil/duncan_outdoors_pupil.mat');

X=data.X;
X(:,111*[0:111]+96 )=X(:,111*[0:111]+97 );



%%
methodd='nearest';
sizes=[111 112];
percent=5;

[X,Y] = meshgrid(1:3, 2:3)
[X_new]=bsxfun(@normalize_percentile, X(1:2,:), repmat(percent,[size(X,1) 1]));
[X_new]=bsxfun(@normalize_percentile, X(1:3,:), repmat(percent,[size(X,1) 1]));
X_new
%sizeHist=sizeHist(1)

%%
[X,Y] = meshgrid(1:3, 2:3)

X_new=normalize_percentile(X,repmat(5,[size(X,1) 1]))
%%
%func=@normalize_percentile;%(x,y)normalize_percentile(x,y);
% 
% [X,Y] = meshgrid(1:3, 2:3)
% 
% size(X)
% X_new=bsxfun(func, X, repmat(5,[size(X,1) 1]));

%%
% for i=1%:size(X,1)
%     
%     [newX,sizeHist]=normalize_percentile(X(i,:),percent,sizes,methodd);
%     
%     %newX1=mean_contrast_adjust_nosave(X);
% end

newX=X_new(1,:)

sub1=3;
sub2=4;
im=reshape(X(1,:)',111,112);

newIm=reshape(newX(1,:)',sizes(1),sizes(2));%,111,112);

%newIm1=reshape(newX1(1,:)',111,112);

%
Ori=reshape(X(1,:)',111,112);
GIm=imresize(Ori,[sizes(1) sizes(2)],methodd);
pixels=round(reshape(GIm,1,[]));

GIm2=imresize(Ori,[sizes(1) sizes(2)],'nearest');
pixels2=round(reshape(GIm2,1,[]));

GIm3=imresize(Ori,[sizes(1) sizes(2)],'bilinear');
pixels3=round(reshape(GIm3,1,[]));


figure;
subplot(sub1,sub2,1)
imagesc(im)
colormap gray
title('original')

subplot(sub1,sub2,2)
imagesc(GIm2)
colormap gray
title(strcat('downscale-',methodd,' method'))

subplot(sub1,sub2,3)
imagesc(newIm)
colormap gray
title('histogram clipping result')


subplot(sub1,sub2,5)
histogram(im)

subplot(sub1,sub2,6)
histogram(GIm3)

subplot(sub1,sub2,7)
histogram(newIm,sizeHist)

adjIm=imadjust(mat2gray(imresize(im,[50 50],methodd)));

subplot(sub1,sub2,4)
imagesc(adjIm)
colormap gray
title('histogram exponent result')

min(min(adjIm))
max(max(adjIm))

subplot(sub1,sub2,8)
histogram(adjIm)
ylim([0 800])

subplot(sub1,sub2,9)
imshow(im2bw(adjIm,0.2))
title('thresholding(threshold=0.15)');


suptitle({'Result: Downscaling the image by half and Histogram clipping','Downscaling method: nearest approach'});

% A = [1 2 3;
%      4 5 6;
%      7 8 9]
% mean(A,1)
% mean(A,2)
% 
% 
% %B = [0 1 2]
% 
% func=@(x,y) normalize_percentile(x,y);
% C = bsxfun(func, A,1)

%http://stackoverflow.com/questions/2307249/how-to-apply-a-function-to-every-row-in-matlab
%C = bsxfun(@(x,y) x.^y, A, B)

